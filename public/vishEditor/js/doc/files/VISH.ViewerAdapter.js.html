<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VISH.ViewerAdapter.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/VISH.Editor.html">VISH.Editor</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ViSH.html">ViSH</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: VISH.ViewerAdapter.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
VISH.ViewerAdapter = (function(V,$,undefined){
	var page_is_fullscreen = false; &#x2F;&#x2F;it always init without fullscreen

	&#x2F;**
	 * Initializer
	 *&#x2F;
	 var init = function(){
	 	_initPager();
	 	setupSize(false);
	 }

	&#x2F;**
	 * function to adapt the slides to the screen size, in case the editor is shown in another iframe
	 * param &quot;fullscreen&quot; indicates that the call comes from a fullscreen button
	 *&#x2F;
	var setupSize = function(fullscreen){
		var reserved_px_for_menubar; &#x2F;&#x2F;we don´t show the menubar
		var margin_height;
		var margin_width;

		if (V.Status.getDevice().mobile) {
			reserved_px_for_menubar = 0; &#x2F;&#x2F;we don´t show the menubar
			margin_height = 0;
			margin_width = 0;
		} else {
			if(fullscreen &amp;&amp; !page_is_fullscreen){
					&#x2F;&#x2F;exit fullscreen
					page_is_fullscreen = true;
					reserved_px_for_menubar = 0; &#x2F;&#x2F;we don´t show the menubar
					margin_height = 0;
					margin_width = 0;
			} else {
				page_is_fullscreen = false;
				if(VISH.Slides.getSlidesQuantity()&gt;1){
					reserved_px_for_menubar = 40;
				} else {
					reserved_px_for_menubar = 0;
				}							
				margin_height = 40;
				margin_width = 30;
			}
		}
		
		var height = $(window).height() - reserved_px_for_menubar; &#x2F;&#x2F;the height to use is the window height - 40px that is the menubar height
		var width = $(window).width();
		var finalW = 800;
		var finalH = 600;
		&#x2F;&#x2F;VISH.Debugging.log(&quot;height &quot; + height);
		&#x2F;&#x2F;VISH.Debugging.log(&quot;width &quot; + width);
		var aspectRatio = width&#x2F;height;
		var slidesRatio = 4&#x2F;3;
		if(aspectRatio &gt; slidesRatio){
			finalH = height - margin_height;  &#x2F;&#x2F;leave 40px free, 20 in the top and 20 in the bottom ideally
			finalW = finalH*slidesRatio;	
		}	else {
			finalW = width - margin_width; &#x2F;&#x2F;leave 110px free, at least, 55 left and 55 right ideally
			finalH = finalW&#x2F;slidesRatio;	
		}
		&#x2F;&#x2F;VISH.Debugging.log(&quot;finalH &quot; + finalH);
		&#x2F;&#x2F;VISH.Debugging.log(&quot;finalW &quot; + finalW);
		$(&quot;.slides &gt; article&quot;).css(&quot;height&quot;, finalH);
		$(&quot;.slides &gt; article&quot;).css(&quot;width&quot;, finalW);
		$(&quot;.subslide&quot;).css(&quot;height&quot;, finalH);
		$(&quot;.subslide&quot;).css(&quot;width&quot;, finalW);

		&#x2F;&#x2F;margin-top and margin-left half of the height and width
		var marginTop = finalH&#x2F;2 + reserved_px_for_menubar&#x2F;2;
		var marginLeft = finalW&#x2F;2;
		$(&quot;.slides &gt; article&quot;).css(&quot;margin-top&quot;, &quot;-&quot; + marginTop + &quot;px&quot;);
		$(&quot;.slides &gt; article&quot;).css(&quot;margin-left&quot;, &quot;-&quot; + marginLeft + &quot;px&quot;);
		
		$(&quot;.subslide&quot;).css(&quot;margin-top&quot;, &quot;-&quot; + finalH&#x2F;2 + &quot;px&quot;);
		$(&quot;.subslide&quot;).css(&quot;margin-left&quot;, &quot;-&quot; + marginLeft + &quot;px&quot;);	
		
		&#x2F;&#x2F;finally font-size, line-height and letter-spacing of articles
		&#x2F;&#x2F;after this change the font sizes of the zones will be relative as they are in ems
		var increase = finalH&#x2F;600;
		&#x2F;&#x2F; var increaseW = finalW&#x2F;800;
		
		&#x2F;&#x2F;and now the arrows have to be increased or decreased
		$(&quot;.fc_poi img&quot;).css(&quot;width&quot;, 50*increase + &quot;px&quot;);
		$(&quot;.fc_poi img&quot;).css(&quot;height&quot;, 50*increase + &quot;px&quot;);
		
		&#x2F;&#x2F;if fancybox is opened, resize it
		if ($(&#x27;#fancy_content:empty&#x27;).length === 0){	
			$(&#x27;#fancybox-inner&#x27;).width(&quot;80%&quot;);
			$(&#x27;#fancybox-wrap&#x27;).width(&quot;80%&quot;);

			$(&quot;#fancybox-content&quot;).width(&quot;80%&quot;);
			$(&quot;#fancybox-content &gt; div&quot;).width(&quot;100%&quot;);
			$(&#x27;#fancybox-inner&#x27;).height(&quot;80%&quot;);
			$(&#x27;#fancybox-wrap&#x27;).height(&quot;80%&quot;);	

			$(&#x27;#fancybox-wrap&#x27;).css(&quot;top&quot;, &quot;10%&quot;);	
			$(&#x27;#fancybox-wrap&#x27;).css(&quot;left&quot;, &quot;10%&quot;);
			&#x2F;&#x2F;TODO check if the excursion has quiz() (fullscreen --&gt; remove QR FS Button)
			V.Quiz.testFullScreen();
		}

		&#x2F;&#x2F; &#x2F;&#x2F;Texts callbacks
		VISH.Text.aftersetupSize(increase);

		&#x2F;&#x2F;Snapshot callbacks
		VISH.SnapshotPlayer.aftersetupSize(increase);
		
		&#x2F;&#x2F;Object callbacks
		VISH.ObjectPlayer.aftersetupSize(increase);		
	};


	var setupInterface = function(options){
		&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;
		&#x2F;&#x2F;Interface changes
		&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;

		if((options)&amp;&amp;(options[&quot;preview&quot;])){
			$(&quot;div#viewerpreview&quot;).show();
			V.Quiz.UnbindStartQuizEvents();
		}

		if((!V.Status.getDevice().desktop)&amp;&amp;(!V.Status.getIsInIframe())&amp;&amp;(options)&amp;&amp;(options[&quot;comeBackUrl&quot;])){
			$(&quot;button#closeButton&quot;).show();
		}

		var renderFull = ((options[&quot;full&quot;]===true)&amp;&amp;(!V.Status.getIsInIframe()) || (options[&quot;forcefull&quot;]===true));

		if(!renderFull){
			&#x2F;&#x2F;we are not in fullscreen
			if (V.Status.getDevice().desktop &amp;&amp; ((options)&amp;&amp;(!options[&quot;preview&quot;]))) {
				_enableFullScreen(options);
			}	else {
			  	$(&quot;#page-fullscreen&quot;).hide();
			}
		} else{
			if(options &amp;&amp; options[&quot;exitFullscreen&quot;]){
	 			&#x2F;&#x2F;we are in fullscreen &quot;simulated&quot;, showing the .full version and we need a close fullscreen
	 			$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px 0px&quot;);
				$(&quot;#page-fullscreen&quot;).hover(function(){
					$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px -40px&quot;);
				}, function() {
					$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px 0px&quot;);
				});
				$(document).on(&#x27;click&#x27;, &#x27;#page-fullscreen&#x27;, function(){
					window.location = options[&quot;exitFullscreen&quot;];
    			});
			}else {
				$(&quot;#page-fullscreen&quot;).hide();
			}
 			setupElements();
			setupSize(true);
	      	decideIfPageSwitcher();
		}
	};

	&#x2F;*
	 * This method enables the fullscreen button, it will change to fullscreen if that feature is present
	 * and if not it is a link to the .full version
	 *&#x2F;
	var _enableFullScreen = function(options){
		if(V.Status.getDevice().features.fullscreen){
			&#x2F;&#x2F;if we have fullscreen feature, use it
			if(V.Status.getIsInIframe()){
				var myDoc = parent.document;
			} else {
				var myDoc = document;
			}
			$(document).on(&#x27;click&#x27;, &#x27;#page-fullscreen&#x27;, V.SlideManager.toggleFullScreen);
			$(myDoc).on(&quot;webkitfullscreenchange mozfullscreenchange fullscreenchange&quot;,function(event){
				V.ViewerAdapter.setupElements();
				&#x2F;&#x2F;Done with a timeout because it did not work well in ubuntu
				setTimeout(function(){
					V.ViewerAdapter.setupSize(true);
					V.ViewerAdapter.decideIfPageSwitcher();
				}, 400);    
			});
		}
		else if(V.Status.getIsInIframe() &amp;&amp; options[&quot;fullscreen&quot;]){
			$(document).on(&#x27;click&#x27;, &#x27;#page-fullscreen&#x27;, function(){
				VISH.Utils.sendParentToURL(options[&quot;fullscreen&quot;]);
    		});
		}
	}

	var setupElements = function(){
		&#x2F;&#x2F;if page is fullscreen, it means we are exiting it
		if(page_is_fullscreen){
			_onLeaveFullScreen();
		} else {
			_onEnterFullScreen();
		}
	};

	var _onEnterFullScreen = function(){
		$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px 0px&quot;);
		$(&quot;#page-fullscreen&quot;).hover(function(){
			$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px -40px&quot;);
		}, function() {
			$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;-45px 0px&quot;);
		});
		_decideIfViewBarShow(true);
	}

	var _onLeaveFullScreen = function(){
		$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;0px 0px&quot;);
		$(&quot;#page-fullscreen&quot;).hover(function(){
			$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;0px -40px&quot;);
		}, function() {
			$(&quot;#page-fullscreen&quot;).css(&quot;background-position&quot;, &quot;0px 0px&quot;);
		});
		_decideIfViewBarShow(false);
	}

	var _decideIfViewBarShow = function(fullScreen){
		if(!fullScreen){
			if(VISH.Slides.getSlidesQuantity()&gt;1){
				$(&quot;#viewbar&quot;).show();
			} else {
				$(&quot;#viewbar&quot;).hide();
			}
		} else {
			$(&quot;#viewbar&quot;).hide();
		}
	}
	
	&#x2F;**
	* Method to add the src to the iframe, show it, hide the slides, and so on
	*&#x2F;
	var setupGame = function(presentation){
		$(&quot;#my_game_iframe&quot;).attr(&quot;src&quot;, presentation.game.src);
		&#x2F;&#x2F;load file game.css dinamically
		var fileref=document.createElement(&quot;link&quot;);
  		fileref.setAttribute(&quot;rel&quot;, &quot;stylesheet&quot;);
  		fileref.setAttribute(&quot;type&quot;, &quot;text&#x2F;css&quot;);
  		fileref.setAttribute(&quot;href&quot;, &quot;stylesheets&#x2F;game&#x2F;game.css&quot;);
  		document.getElementsByTagName(&quot;body&quot;)[0].appendChild(fileref);
	};


	var _initPager = function(){
		if(V.Status.getDevice().desktop){
			$(&quot;#back_arrow&quot;).html(&quot;&quot;);
			$(&quot;#forward_arrow&quot;).html(&quot;&quot;);

			if(VISH.Slides.getSlidesQuantity()&gt;1){
				$(&quot;#viewbar&quot;).show();
				VISH.SlideManager.updateSlideCounter();
			} else {
				$(&quot;#viewbar&quot;).hide();
			}
		} else {
			$(&quot;#viewbar&quot;).hide();
		}
	}


	&#x2F;**
	 * Function to hide&#x2F;show the page-switchers buttons in the viewer
	 * hide the left one if on first slide
	 * hide the right one if on last slide
	 * show both otherwise
	 *&#x2F;
	var decideIfPageSwitcher = function(){
		if (VISH.Slides.getCurrentSubSlide()!==null){
			&#x2F;&#x2F;Subslide active
			$(&quot;#forward_arrow&quot;).hide();
			$(&quot;#back_arrow&quot;).hide();
		} else {
			&#x2F;&#x2F;No subslide
			if(VISH.Slides.isCurrentFirstSlide()){
				$(&quot;#back_arrow&quot;).hide();
			} else {
				$(&quot;#back_arrow&quot;).show();
			} 
			if (VISH.Slides.isCurrentLastSlide()){
				$(&quot;#forward_arrow&quot;).hide();		
			} else {
				$(&quot;#forward_arrow&quot;).show();
			}
		}

		if(!page_is_fullscreen &amp;&amp; !V.Status.getDevice().mobile){
			if(VISH.Slides.isCurrentFirstSlide()){
				$(&quot;#page-switcher-start&quot;).hide();			
			} else {
				$(&quot;#page-switcher-start&quot;).show();
			}  
			if(VISH.Slides.isCurrentLastSlide()){
				$(&quot;#page-switcher-end&quot;).hide();	
			} else {
				$(&quot;#page-switcher-end&quot;).show();
			}
		}		
	};
	
	return {
		init 					: init,
		decideIfPageSwitcher	: decideIfPageSwitcher,
		setupElements			: setupElements,
		setupGame				: setupGame,
		setupInterface			: setupInterface,
		setupSize				: setupSize
	};
}) (VISH, jQuery);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
